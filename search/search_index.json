{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"MassQL Introduction","text":""},{"location":"#about-mass-spec-query-language","title":"About Mass Spec Query Language","text":"<p>The Mass Spec Query Langauge (MassQL) is a domain specific language meant to be a succinct way to  express a query in a mass spectrometry centric fashion. It is inspired by SQL,  but it attempts to bake in assumptions of mass spectrometry to make querying much more natural for mass spectrometry users. Broadly we attempt to design it according to several principles:</p> <ol> <li>Expressiveness - Capture complex mass spectrometry patterns that the community would like to look for</li> <li>Precision - Exactly prescribe how to find data without ambiguity</li> <li>Relatively Natural - MassQL should be relatively easy to read and write and even use as a way to communicate ideas about mass spectrometry, you know like a language. </li> </ol>"},{"location":"#why-does-mass-spec-query-language-exist","title":"Why does Mass Spec Query Language Exist?","text":"<p>The intrinsic physical and chemical property of molecules when analyzed by mass spectrometry imprint patterns upon mass spectrometry data. This affords the opportunity to formulate queries to find these patterns in raw mass spectrometry data. However, within the computational mass spectrometry ecosystem, the lack of a ergonomic, flexible, and scalable approach to express these patterns prevents the community from taking full advantage of expert knowledge of these patterns to thoroughly and quickly mine mass spectrometry data for new molecules. Therefore, I created the Mass Spectrometry Query Language (MassQL) to empower mass spectrometrists and chemists to write their own queries in a flexible, precise, and scalable fashion. </p>"},{"location":"#developers","title":"Developers","text":"<p>Mingxun Wang is the creator and main developer of MassQL. Please contact me if you have questions! I'm hoping this becomes a community effort so reach out if you want to help/use MassQL. </p>"},{"location":"#definition-of-a-query","title":"Definition of a Query","text":"<p>There are several parts</p> <pre><code>QUERY\n&lt;Type of Data&gt;\nWHERE\n&lt;Condition&gt;\nAND\n&lt;Condition&gt;\nFILTER\n&lt;Filter&gt;\nAND\n&lt;Filter&gt;\n</code></pre>"},{"location":"#type-of-data","title":"Type of Data","text":"<p>This determines the type of data you want to get. At its most fundamental level, its the peaks for either </p> <ol> <li>MS1DATA</li> <li>MS2DATA</li> </ol> <p>Further, there are functions that can modify this data</p> <ol> <li>scaninfo - This provides likely the most information you'd want for each scan</li> <li>scansum - Summation of the scan (TIC)</li> <li>scannum - Returns the scan number </li> <li>scanmaxint - Returns the max intensity per spectrum (BPI)</li> </ol> <p>Experimental Functions</p> <ol> <li>scanrangesum</li> <li>scanmaxmz</li> <li>scanrun</li> </ol>"},{"location":"#conditionals","title":"Conditionals","text":"<p>These are conditions to filter for scans of interest (by looking for peaks and sets of peaks) within the mass spectrometry data. You can create clauses,  which are specific conditions and the associated qualifiers. You may further combine multiple conditions with <code>AND</code>. <code>AND</code> will indicate that within a specific spectrum, all the conditions must be met. </p> <p>Info</p> <p>The syntax for this is <code>&lt;condition&gt;=&lt;value&gt;</code>, e.g. <code>MS2PROD=144.1</code>.</p> <p>The types of conditions are as follows</p>"},{"location":"#rtmin","title":"RTMIN","text":"<p>Setting the minimum retention time in minutes</p>"},{"location":"#rtmax","title":"RTMAX","text":"<p>Setting the maximum retention time in minutes</p>"},{"location":"#scanmin","title":"SCANMIN","text":"<p>Setting the minimum scan number (this is inclusive)</p>"},{"location":"#scanmax","title":"SCANMAX","text":"<p>Setting the maximum scan number (this is inclusive)</p>"},{"location":"#charge","title":"CHARGE","text":"<p>Finding MS2 spectra with a given charge if reported by the instrument</p>"},{"location":"#polarity","title":"POLARITY","text":"<p>The polarity that will be chosen. (Positive, Negative)</p>"},{"location":"#ms2prod","title":"MS2PROD","text":"<p>Looking for an MS2 peak</p>"},{"location":"#ms2prec","title":"MS2PREC","text":"<p>Looking for an MS2 precursor m/z</p>"},{"location":"#ms1mz","title":"MS1MZ","text":"<p>Looking for MS1 peak m/z</p>"},{"location":"#mobility","title":"MOBILITY","text":"<p>We have a special keyword to interact with mobility data. Specifically, the syntax enables you to set min and max bounds for the mobility</p> <pre><code>MOBILITY=range(min=1, max=2)\n</code></pre> <p>The units here are whatever your mass spectrometer reports and are not converted to collision cross section (CCS). </p> <p>Fun with m/z variables and Mobility</p> <p>You can even create polygons within the m/z mobility space to get data. Here is a quick example <pre><code>QUERY scaninfo(MS2DATA) WHERE MS2PREC=X AND MOBILITY=range(min=X*0.0011+0.5-0.1, max=X*0.0011+0.5+0.1)\n</code></pre> This represents approximately this parallelogram region. </p> <p></p>"},{"location":"#ms2nl","title":"MS2NL","text":"<p>Looking for a neutral loss from precursor m/z in the MS2 spectrum. For example, if a molecule has a precursor m/z of 500, and you are searching for an MS2NL of 16, it will look for a peak appearing at 500 - 16 = 484 m/z. </p>"},{"location":"#qualifiers","title":"Qualifiers","text":"<p>These can be attached to conditions to modify some properties about the peaks we are looking for. </p>"},{"location":"#mass-accuracy","title":"Mass Accuracy","text":"<p>These two fields enable setting a peak m/z tolerance</p> <pre><code>TOLERANCEMZ=0.1\nTOLERANCEPPM=50\n</code></pre> <p>Default Values</p> <p>The default tolerance when no qualifier is provided is 0.1 Da.</p>"},{"location":"#intensity-relative-to-full-spectrum","title":"Intensity Relative to Full Spectrum","text":"<p>These two fields enable to set an minimum intensity</p> <pre><code>INTENSITYVALUE=1000\nINTENSITYPERCENT=10\nINTENSITYTICPERCENT=10\n</code></pre> <p>INTENSITYVALUE - This indicates a minimum intensity value in terms of arbitrary units. INTENSITYPERCENT - This indicates a minimum percent of maximum peak in the spectrum. INTENSITYTICPERCENT - This indicates a minimum percent of total TIC in the spectra. </p> <p>Default Values</p> <p>The default minimum intensity value is 0, so it will accept any peak. This is generally not what you want, so likely you do want to set this. </p>"},{"location":"#intensity-relative-to-other-peaks","title":"Intensity Relative to Other Peaks","text":"<p>Here we can start imposing relative intensities between peaks</p> <pre><code>INTENSITYMATCHREFERENCE\nINTENSITYMATCH=Y\nINTENSITYMATCH=Y*2\nINTENSITYMATCHPERCENT=10\n</code></pre> <p>Intensity Matching Between Peaks</p> <p>This is actually complicated, but you'll end up with one peak per variable that is the reference and all others are relative to that reference.  <pre><code>WHERE \nMS1MZ=X:INTENSITYMATCH=Y:INTENSITYMATCHREFERENCE # This is the reference peak which all other peaks' intensities will be compared to\nAND \nMS1MZ=X+2:INTENSITYMATCH=Y*2:INTENSITYMATCHPERCENT=1 # The Y*2 denotes that it must be 2 times the intensity of the first peak\n</code></pre></p>"},{"location":"#values-of-conditions-qualifiers","title":"Values of Conditions, Qualifiers","text":"<p>As mentioned above, the value of certain conditions can be numbers (more precisely floats). However, its sometimes in convenient to have to actually calculate out the m/z for an MS2PROD condition and also the derivation is obfuscated if its just a single number. You can simply list it out as a numerical expression</p> <pre><code>MS2PROD=100+14\n</code></pre> <p>and this will get calculated to mean</p> <pre><code>MS2PROD=114\n</code></pre> <p>You can even do more advanced things that are native to chemistry/biochemistry without having to look up numbers, and they are listed below. </p> <p>MS2MZ and MS2PROD synonyms</p> <p>MS2MZ and MS2PROD mean the same thing in the language. </p>"},{"location":"#any-keyword","title":"ANY keyword","text":"<p>If you do not have a specific requirement of a peak m/z, you can use the ANY keyword. </p> <p>For example:</p> <pre><code>MS2PROD=ANY:MASSDEFECT=massdefect(min=0.1, max=0.2)\n</code></pre>"},{"location":"#variables","title":"Variables","text":"<p>In cases where you do not know the mass of the peaks for a specific pattern, but you know the pattern of peaks relative to each other, e.g. isotopic patterns, you can use the variable X in place. For example:</p> <pre><code>QUERY scaninfo(MS2DATA) WHERE MS2PROD=X and MS2NL=X+16\n</code></pre> <p>Limiting Range of X</p> <p>If you want to limit the range you can set another condition, <code>X=range(min=100, max=500)</code></p> <p>Limiting Mass Defect of X</p> <p>If you want to set limits on the decimal part of X, you can set another condition, <code>X=massdefect(min=0.1, max=0.5)</code></p>"},{"location":"#molecular-formula","title":"Molecular Formula","text":"<p>To save us all a little bit of time convert lookup of formulas into masses, you can use the syntax:</p> <pre><code>MS2PROD=formula(H2O)\n</code></pre> <p>to easily calcualte the mono isotopic mass of H2O. It will substitute as</p> <pre><code>MS2PROD=18.01056468403\n</code></pre> <p>Advanced Usage</p> <p>If you want to make functions out of formula masses, you totally can, like below</p> <pre><code>MS2PROD=100 + formula(CH2)*2\n</code></pre>"},{"location":"#amino-acid-masses","title":"Amino Acid Masses","text":"<p>To calculate amino acid masses, you can use the following syntax</p> <pre><code>MS2PROD=100 + aminoaciddelta(G)\n</code></pre> <p>which will calculate out to </p> <pre><code>MS2PROD=157.02146372057\n</code></pre> <p>Multiple Amino Acids</p> <p>If you want to use multiple amino acids, no problem:</p> <pre><code>MS2PROD=aminoaciddelta(GA)\n</code></pre>"},{"location":"#peptide-masses","title":"Peptide Masses","text":"<p>If you're in the proteomics camp, you can automatically calculate peptide fragementation. </p> <pre><code>MS2PROD=peptide(G, charge=1, ion=y)\n</code></pre> <p>will yield</p> <pre><code>MS2PROD=76.03930487103999\n</code></pre>"},{"location":"#filters","title":"Filters","text":"<p>Filters are like conditional but we don't elimate scans based on the condition. Rather, we simply filter out peaks within the spectra. </p> <p>This is useful for things like SRM or SIM/XIC. </p>"},{"location":"#misc","title":"Misc","text":""},{"location":"#or-operations","title":"OR operations","text":"<p>If you are looking for two peaks but either of them could be present, you can use the following syntax</p> <pre><code>MS2PROD=(100 OR 104)\n</code></pre> <p>You can use with variables as well.</p> <p>With OR operations, you can specify multiple masses to look for. To give you more flexibility, you can require a minimum and maximum number of those masses to appear in a single mass spectrum. You can use the CARDINALITY qualifier to denote how many of the optional masses should appear. For example if 2 out of the 3 masses should appear:</p> <pre><code>MS2PROD=(100 OR 104 OR 106):CARDINALITY=range(min=2, max=2)\n</code></pre>"},{"location":"#massql-patterns","title":"MassQL Patterns","text":"<p>If you're interested in doing some more advanced queries in MassQL, we have a dedicated patterns page to show you  ways we've approached some interesting applications. By no means is it comprehensive, but we hope it helps. Check it out here.</p>"},{"location":"#examples","title":"Examples","text":""},{"location":"#xic-generation","title":"XIC Generation","text":"<p>MS1 XIC, m/z = 100</p> <pre><code>QUERY scansum(MS1DATA) FILTER MS1MZ=100:TOLERANCEMZ=0.1\n</code></pre>"},{"location":"#ms2-with-sugar-loss-neutral-loss-scan","title":"MS2 With Sugar Loss - Neutral Loss Scan","text":"<p>Neutral Loss, 163 Da</p> <pre><code>QUERY scaninfo(MS2DATA) WHERE MS2NL=163\n</code></pre>"},{"location":"#brominated-compounds","title":"Brominated Compounds","text":"<pre><code>QUERY scaninfo(MS2DATA) WHERE \nMS1MZ=X:INTENSITYMATCH=Y:INTENSITYMATCHREFERENCE \nAND MS1MZ=X+2:INTENSITYMATCH=Y:INTENSITYMATCHPERCENT=5\nAND MS2PREC=X\n</code></pre>"},{"location":"#ms2-with-distinct-fragments-precursor-ion-scan","title":"MS2 with distinct fragment(s) - Precursor Ion Scan","text":"<p>One Product Ion, m/z = 660.2 <pre><code>QUERY scaninfo(MS2DATA) WHERE MS2PROD=660.2:TOLERANCEMZ=0.1\n</code></pre></p> <p>Two Product Ions, m/z = 660.2 and 468.2 <pre><code>QUERY scaninfo(MS2DATA) WHERE MS2PROD=660.2:TOLERANCEMZ=0.1 AND MS2PROD=468.2:TOLERANCEMZ=0.1\n</code></pre></p>"},{"location":"#how-to-use-massql","title":"How To Use MassQL","text":""},{"location":"#python-api","title":"Python API","text":"<p>We have a python API that you can utilize in your own software. Checkout the package here on PyPi.</p>"},{"location":"#r-api","title":"R API","text":"<p>We have an R implementation by the community, check it out here.</p>"},{"location":"#commandline-utility","title":"Commandline Utility","text":"<p>We have a standalone script that can execute queries on spectrum files that can be installed by the package PyPi.</p>"},{"location":"#nextflow-workflow","title":"Nextflow Workflow","text":"<p>We have a nextflow workflow to enable scalable queries across hundreds of thousands of mass spectrometry files. </p>"},{"location":"#proteosafe-workflow","title":"ProteoSAFe Workflow","text":"<p>We have a proteosafe workflow that we have created that nicely integrates into GNPS - Try the beta here.</p> <p>See more details here.</p>"},{"location":"#workflow-details","title":"Workflow Details","text":"<p>There are several options that you probably will care about</p> <ol> <li>Extracting found MS scans as part of output, default this is off, if you want to do downstream molecular networking - turn this on</li> <li>If you want to run multiple queries together, you can now, just separate your queries with <code>|||</code> and then results from multiple queries will be merged together</li> </ol> <p>GNPS Repository Scale Queries</p> <p>One of the powerful things with MassQL is the ability to scale up to huge amounts of data. Luckily at GNPS we have tons of data. You can use the above workflow to  select datasets (or your own), with hundreds of files queriable at once. However, sometimes you want to go really big and search everything at once. We have these tools available but they currently require a large amount of compute and require special permissions. If you want to do repository scale queries, please contact Ming to collaborate on it. </p>"},{"location":"#pyopenms","title":"PyOpenMS","text":"<p>You can checkout how to use MassQL In PyOpenMS here.</p>"},{"location":"#web-api","title":"Web API","text":"<p>We have built out a web API for people to use, especially for parsing. </p> <pre><code>https://msql.ucsd.edu/parse?query=QUERY%20MS2DATA%20WHERE%20MS1MZ=100\n</code></pre> <p>Simply put in the query as a url encoded parameter and a JSON representation of the parse is returned. </p>"},{"location":"#interactive-web-sandbox","title":"Interactive Web Sandbox","text":"<p>Checkout the interactive sandbox here. </p>"},{"location":"#debugging-your-query","title":"Debugging Your Query","text":"<p>I would recommend you check out the interactive sandbox listed above. One of the features here is we try to translate your MassQL query into a visualization and into English. Generally issues with queries run into problems with of misunderstanding what each condition and qualifier mean or setting your requirements a bit too strict. Both the visualization and translation to English helps with that. </p>"},{"location":"gnps/","title":"MassQL GNPS Workflow","text":""},{"location":"gnps/#gnps-massql-workflow","title":"GNPS MassQL Workflow","text":"<p>You can execute your MassQL queries against your own data or public data at GNPS in a highthroughput fashion. Whether its one file or 250K, its possible at GNPS. </p> <p>Check out the workflow here.</p>"},{"location":"gnps/#input-parameters","title":"Input Parameters","text":"<ol> <li>Query</li> <li>Spectrum Files</li> <li>Paralleize within a single file - ignore this</li> <li>Parallelize Across All Files - To increase a little bit of speed if you have multiple files, turn to Yes</li> <li>Extract Found MS Spectra - if you want to extract the found MS spectra for networking</li> <li>Parallelize across the Cluster - admin only</li> </ol>"},{"location":"gnps/#query","title":"Query","text":"<p>Enter your query in this field. You can simply paste one in or write it here. </p> <p>Multiple Queries</p> <p>If you want to run multiple queries you can separate each query with <code>|||</code> and all results are merged together</p>"},{"location":"gnps/#results-views","title":"Results Views","text":""},{"location":"gnps/#query-results","title":"Query Results","text":"<p>You can see all query results.</p>"},{"location":"gnps/#extraction-results","title":"Extraction Results","text":"<p>If you selected the extraction, then you can view the extracted spectra in case its not possible to view the spectra from the original query data. </p>"},{"location":"gnps/#molecular-networking","title":"Molecular Networking","text":"<p>You can take the extracted data and create a molecular network. </p>"},{"location":"gnps/#falcon-clustering","title":"Falcon Clustering","text":"<p>You can take the extracted data and cluster the data with Falcon to create a molecular network downstream. Generally, Falcon performs better at clustering when reducing redundancy of the same precursor.</p>"},{"location":"gnps/#library-search","title":"Library Search","text":"<p>You can take the extracted data and search the library.</p>"},{"location":"gnps/#troubleshooting","title":"Troubleshooting","text":"<ol> <li>If you don't get any results, go ahead and check the \"Workflow Trace\" to make sure its not all failed. </li> <li>Checkout the interactive app to try out your query on GNPS Libraries</li> </ol>"},{"location":"gnps/#examples","title":"Examples","text":""},{"location":"gnps/#sanity-test","title":"Sanity Test","text":"<p>Link</p>"},{"location":"gnps/#iron-siderophore","title":"Iron Siderophore","text":"<p>Link</p>"},{"location":"patterns/","title":"MassQL Patterns","text":"<p>This page includes common patterns that you might want to query for in mass spec data</p>"},{"location":"patterns/#query-mass-spectrometry-data","title":"Query Mass Spectrometry Data","text":""},{"location":"patterns/#ms1-precursor-ions-based-on-monoisotopic-mass-with-absolute-mass-error","title":"MS1 precursor ion/s based on monoisotopic mass with absolute mass error","text":"<p>Finding MS1 peak at m/z 256.1696 with a 0.01 m/z tolerance. <pre><code>QUERY scaninfo(MS1DATA) WHERE \nMS1MZ=256.1696:TOLERANCEMZ=0.01\n</code></pre></p>"},{"location":"patterns/#ms1-precursor-ions-based-on-monoisotopic-mass-with-relative-mass-error","title":"MS1 precursor ion/s based on monoisotopic mass with relative mass error","text":"<p>Finding MS1 peak at m/z 256.1696 with a 5.0 ppm tolerance. <pre><code>QUERY scaninfo(MS1DATA) WHERE \nMS1MZ=256.1696:TOLERANCEPPM=5\n</code></pre></p>"},{"location":"patterns/#ms1-precursor-ions-based-on-monoisotopic-mass-and-isotope-mass-with-relative-mass-error","title":"MS1 precursor ion/s based on monoisotopic mass and isotope mass with relative mass error","text":"<p>Finding MS1 peak at m/z 256.1696 Finding MS1 peak at m/z 258.1656 with a 5.0 PPM tolerance. *example: monoisotopic mass + 1.996 for 34S <pre><code>QUERY scaninfo(MS1DATA) WHERE\nMS1MZ=256.1696 AND\nMS1MZ=258.1656:TOLERANCEPPM=5\n</code></pre></p>"},{"location":"patterns/#ms1-precursor-ions-with-34s-isotope-pattern","title":"MS1 precursor ion/s with 34S isotope pattern","text":"<p>Finding MS1 peak at m/z X. Finding MS1 peak at m/z X+1.996 with a 5.0 PPM tolerance. <pre><code>QUERY scaninfo(MS1DATA) WHERE \nMS1MZ=X AND\nMS1MZ=X+1.996:TOLERANCEPPM=5\n</code></pre></p>"},{"location":"patterns/#ms2-spectrum-with-product-ion-with-absolute-mass-error","title":"MS2 spectrum with product ion with absolute mass error","text":"<p>Finding MS2 peak at m/z 167.0857 with a 0.01 m/z tolerance. <pre><code>QUERY scaninfo(MS2DATA) WHERE\nMS2PROD=167.0857:TOLERANCEMZ=0.01\n</code></pre></p>"},{"location":"patterns/#ms2-spectrum-with-product-ion-with-relative-mass-error","title":"MS2 spectrum with product ion with relative mass error","text":"<p>Finding MS2 peak at m/z 167.0857 with a 5.0 ppm tolerance. <pre><code>QUERY scaninfo(MS2DATA) WHERE\nMS2PROD=167.0857:TOLERANCEPPM=5\n</code></pre></p>"},{"location":"patterns/#ms2-spectrum-with-a-neutral-loss-and-product-ion-with-relative-mass-error","title":"MS2 spectrum with a neutral loss and product ion with relative mass error","text":"<p>Finding MS2 neutral loss peak at m/z 176.0321. Finding MS2 peak at m/z 85.02915 a 5.0 PPM tolerance. <pre><code>QUERY scaninfo(MS2DATA) WHERE\nMS2NL=176.0321 AND\nMS2PROD=85.02915:TOLERANCEPPM=5\n</code></pre></p>"},{"location":"patterns/#ms1-scan-associated-with-ms2-spectrum-containing-a-product-ion-with-absolute-mass-error","title":"MS1 scan associated with MS2 spectrum containing a product ion with absolute mass error","text":"<p>Finding MS1 scan associated with MS2 spectrum - relevant to data-dependent acquisition experiments <pre><code>QUERY MS1DATA WHERE\nMS2PROD=167.0857:TOLERANCEPPM=5\n</code></pre></p>"},{"location":"patterns/#query-liquidgas-chromatography-mass-spectrometry-data","title":"Query Liquid/Gas Chromatography - Mass Spectrometry Data","text":""},{"location":"patterns/#total-ion-chromatogram","title":"Total ion chromatogram","text":"<p>Returning the summed scan information on MS1. <pre><code>QUERY scansum(MS1DATA)\n</code></pre></p>"},{"location":"patterns/#extracted-ion-chromatogram","title":"Extracted ion chromatogram","text":"<pre><code>QUERY scansum(MS1DATA) FILTER\nMS1MZ=256.1696:TOLERANCEPPM=5\n</code></pre>"},{"location":"patterns/#ms2-spectra-with-a-given-ms1-isotopic-pattern","title":"MS2 spectra with a given MS1 isotopic pattern","text":"<p>If you're looking for molecules with an isotopic pattern and want to get the MS2 spectra associated with it, we have a pretty easy way to do this. </p> <p>Since you're looking for a variable m/z denoted as X, once you find it, simply enforce the MS2 precursor m/z to also be X.</p> <p>Note</p> <p>This will cause isotopic patterns that lack MS2 to be dropped</p> <p>Here is a quick example of a query</p> <pre><code>QUERY scaninfo(MS2DATA) WHERE \nMS1MZ=X AND \nMS1MZ=X+1 AND \nMS2PREC=X\n</code></pre>"},{"location":"patterns/#dynamic-shapes-with-mobility","title":"Dynamic Shapes With Mobility","text":"<p>If you're looking for certain mobility of molecules that is dependent upon the m/z of the molecule, you can start including variables in the mobility range function. </p> <pre><code>QUERY scaninfo(MS2DATA) WHERE MS2PREC=X AND MOBILITY=range(min=X*0.0011+0.5-0.1, max=X*0.0011+0.5+0.1\n</code></pre>"},{"location":"usecases/","title":"MassQL Use Cases","text":""},{"location":"usecases/#massql-query-for-organophosphate-compounds-in-the-environment","title":"MassQL Query for Organophosphate Compounds in the Environment","text":"<p>Author/s: Nina Zhao</p>"},{"location":"usecases/#massql-query","title":"MassQL Query","text":"<pre><code>QUERY scansum(MS2DATA) WHERE MS2PROD=98.9847:TOLERANCEPPM=50:INTENSITYPERCENT=50 FILTER MS2PROD=98.9847\n</code></pre>"},{"location":"usecases/#massql-translation","title":"MassQL Translation","text":"<p>Returning the summed scan information on MS2. The following conditions are applied to find scans in the mass spec data:</p> <ul> <li>Finding MS2 peak at m/z 98.9847 with a 50.0 PPM tolerance and a minimum percent intensity relative to base peak of 50.0%.</li> <li>Finding MS2 peak at m/z 98.9847.</li> </ul>"},{"location":"usecases/#massql-query-link","title":"MassQL Query Link","text":"<p>MassQL Query Link</p>"},{"location":"usecases/#additional-data-analysis","title":"Additional Data Analysis","text":""},{"location":"usecases/#gnps-msms-library-search","title":"GNPS MS/MS Library Search","text":"<p>GNPS MS/MS Library Search</p>"},{"location":"usecases/#data-availability","title":"Data Availability","text":"<p>MSV000087187</p>"},{"location":"usecases/#background","title":"Background","text":"<p>Organophosphate esters (OPEs) are widely used as flame retardants and plasticizers in consumer and industrial products. The environmental hazard of OPEs is of concern due to their increasing usage as the replacements of traditional brominated flame retardants and their toxicity effects, which include fecundity decrease, thyroid endocrine disruption, and developmental toxicity in fish. Most of the environmental investigations on OPEs employ targeted analysis with mass spectrometry, but recent studies utilizing non-targeted mass spectrometry have revealed novel OPEs. Therefore, screening strategies for OPEs in environmental samples are needed.</p> <p>OPEs have the general structure O=P(OR)3, a central phosphate group with three alkyl or aromatic moieties. Previous studies have reported the phosphate ion (H4O4P+, m/z 98.9842) as the diagnostic fragment of this class of chemicals. We previously identified several OPEs in the marine water samples from Puget Sound. Here, we used MassQL to search for the phosphate ion fragment in the same dataset.</p>"},{"location":"usecases/#results","title":"Results","text":"<p>MassQL returned 771 spectra hits; among them, ~22% (182, belonging to 4 major precursors m/z) were noise spectra which required further filters on percent of total intensity to be ruled out. The rest of the spectra hits (589) belong to ~60 unique molecular features and show a true fragment of m/z 98.98. A subsequent library search identified four OPEs: tributyl phosphate, tris(chloroethyl) phosphate, tris(chloroisopropyl) phosphate, and tris(butoxyethyl) phosphate, explaining ~56% (331) of the non-noise spectra hits. Tributyl phosphate was not identified in our original publication based on traditional fold-change non-targeted analysis. This example demonstrated the possibility to screen for environmental contaminants in MS data without a predefined suspect list.</p>"},{"location":"usecases/#massql-query-for-organophosphate-compounds-in-the-environment-at-data-repository-scale","title":"MassQL Query for Organophosphate Compounds in the Environment at Data Repository Scale","text":"<p>Author/s: Nina Zhao</p>"},{"location":"usecases/#massql-query_1","title":"MassQL Query","text":"<pre><code>QUERY scansum(MS2DATA) WHERE MS2PROD=98.9847:TOLERANCEPPM=50:INTENSITYPERCENT=50 FILTER MS2PROD=98.9847\n</code></pre>"},{"location":"usecases/#massql-translation_1","title":"MassQL Translation","text":"<p>Returning the summed scan information on MS2. The following conditions are applied to find scans in the mass spec data:</p> <ul> <li>Finding MS2 peak at m/z 98.9847 with a 50.0 PPM tolerance and a minimum percent intensity relative to base peak of 50.0%.</li> <li>Finding MS2 peak at m/z 98.9847.</li> </ul>"},{"location":"usecases/#massql-query-link-repository-scale","title":"MassQL Query Link (repository-scale)","text":"<p>MassQL Query Link</p>"},{"location":"usecases/#additional-data-analysis_1","title":"Additional Data Analysis","text":""},{"location":"usecases/#falcon-cluster-eps-03","title":"Falcon Cluster, EPS = 0.3","text":"<p>Falcon Cluster</p>"},{"location":"usecases/#gnps-molecular-networking","title":"GNPS Molecular Networking","text":"<p>GNPS Molecular Networking</p>"},{"location":"usecases/#data-availability_1","title":"Data Availability","text":"<p>All public data from Q Exactive on GNPS</p>"},{"location":"usecases/#background_1","title":"Background","text":"<p>To discover novel organophosphate compounds, we ran the phosphate ion MassQL query developed in Use Case 1.1.1 over all Q Exactive data on the GNPS repository. The MassQL query returned 338,439 spectra hits in total. Based on a comprehensive list of organophosphate compounds (n = 95) compiled by Ye et al. (2021), only 15% (51,310) of the spectra hits could be explained by these known organophosphate compounds (based on precursor m/z match with 20 ppm mass error). Top matches included tris(chloropropyl) phosphate (31,039 matches), tributyl phosphate and isomers (12,967 matches), tri(2-ethylhexyl) phosphate (or structural isomers; 3511 matches), and triethyl phosphate (2171 matches). The remaining 85% matches represent a candidate pool for new organophosphate compounds.</p>"},{"location":"usecases/#results_1","title":"Results","text":"<p>We further analyzed the query results using molecular networking. MS-Cluster, the clustering tool for classical molecular networking on GNPS, failed to handle such a large amount of spectra and returned many repetitive clusters. We explored a newly developed clustering tool, Falcon, which very effectively reduced the number of repetitive clusters. Sending the Falcon output to molecular networking returned 169 spectra families. Mining into these spectra families led to new compound identification. For example, SI Figure 1.1.2 - 1a demonstrated a spectra family of organophosphate compounds with alkyl substituents. The m/z 267.17 represented tributyl phosphate with dimers at m/z 533.34, and the m/z 435.36 represented trioctyl phosphate (or structural isomers) with dimers at m/z 869.71 and trimers at m/z 1305.07. Notably, the group of m/z 211.03 matched the molar mass of dibutyl phosphate, which was not discovered by library search. SI Figure 1.1.2 - 1b demonstrated a spectra family of chlorinated organophosphate compounds. The m/z 428.89 matched tris(dichloro-propyl) phosphate, and m/z 327.01 matched tris(chloro-propryl) phosphate compounds. Such findings highlighted the capacity of MassQL coupled to classical molecular networking to connect related chemicals on a repository scale and to identify new chemicals.</p> <p>TODO: Insert figures</p>"},{"location":"usecases/#detection-of-fusaricidin-depsipeptides-in-microbial-extracts","title":"Detection of Fusaricidin Depsipeptides in Microbial Extracts","text":"<p>Author/s: Osama G. Mohamed and Ashootosh Tripathi</p>"},{"location":"usecases/#massql-query_2","title":"MassQL Query","text":"<p>QUERY scaninfo(MS2DATA) WHERE  MS2NL=255.23: TOLERANCEMZ=0.02 AND MS2PROD=256.23:TOLERANCEMZ=0.02</p>"},{"location":"usecases/#massql-translation_2","title":"MassQL Translation","text":"<p>Returning the scan information on MS2. The following conditions are applied to find scans in the mass spec data:</p> <ul> <li>Finding MS2 neutral loss peak at m/z 255.23 with a 0.02 m/z tolerance.</li> <li>Finding MS2 peak at m/z 256.23 with a 0.02 m/z tolerance.</li> </ul>"},{"location":"usecases/#massql-query-link_1","title":"MassQL Query Link","text":"<p>MassQL Query Link</p>"},{"location":"usecases/#massql-query-link-large-scale","title":"MassQL Query Link (large scale)","text":"<p>MassQL Query Link (large scale)</p>"},{"location":"usecases/#additional-data-analysis_2","title":"Additional Data Analysis","text":""},{"location":"usecases/#gnps-molecular-networking_1","title":"GNPS Molecular Networking","text":"<p>GNPS Molecular Networking</p>"},{"location":"usecases/#background_2","title":"Background","text":"<p>Fusaricidins are a class of cyclic lipopeptides isolated from Paenibacillus sp. Their structures consist of two moieties, a cyclic polypeptide that consists of six amino acids and a guanidino-3-hydroxypentadecanoic acid fatty acid moiety (GHPD). This class of metabolites has shown in vitro antimicrobial activity against Gram-positive bacteria and Fusarium fungi. Fusaricidins MS2 fragmentation spectra are characterized with the fragment product ion m/z 256.2389 (GHPD) and neutral loss of 255.23 (residual cyclopeptide moiety, MH-GHPD) (SI Figure 1.2 - 1).</p> <p>The use of MassQL enabled us to quickly detect and group fusaricidins in a microbial extract. The current resources of University of Michigan Natural Products Discovery Core (UM-NPDC) include a library of over 50,000 natural product extracts (NPE) collected and curated from across the world, including Costa Rica, Papua New Guinea, Israel, Nepal, Panama, Peru, and the United States. To date, approximately 3000 NPEs have been chemically profiled using UHPLC-qTOF, and the collection is still growing. This tool can foster the discovery process of new congeners of interesting metabolites with characteristic tandem MS spectra.</p> <p>TODO: Insert figure</p>"},{"location":"usecases/#impact-of-leishmania-major-infection-on-glycerophosphocholine-lipids","title":"Impact of Leishmania major Infection on Glycerophosphocholine Lipids","text":"<p>Author/s: Laura-Isobel McCall</p>"},{"location":"usecases/#massql-query_3","title":"MassQL Query","text":"<p>QUERY scaninfo(MS2DATA) WHERE  MS2PROD=184.0739:TOLERANCEMZ=0.01:INTENSITYPERCENT=30:INTENSITYVALUE=500 AND  MS2PROD=125.0004:TOLERANCEMZ=0.01:INTENSITYPERCENT=10:INTENSITYVALUE=1500 AND  MS2PROD=104.1075:TOLERANCEMZ=0.01 AND  MS2PROD=86.09697:TOLERANCEMZ=0.01:INTENSITYPERCENT=10:INTENSITYVALUE=2000</p>"},{"location":"usecases/#massql-translation_3","title":"MassQL Translation","text":"<p>Returning the scan information on MS2. The following conditions are applied to find scans in the mass spec data:</p> <ul> <li>Finding MS2 peak at m/z 184.0739 with a 0.01 m/z tolerance, a minimum percent intensity relative to base peak of 30.0%, and a minimum intensity value of 500.0.</li> <li>Finding MS2 peak at m/z 125.0004 with a 0.01 m/z tolerance, a minimum percent intensity relative to base peak of 10.0%, and a minimum intensity value of 1500.0.</li> <li>Finding MS2 peak at m/z 104.1075 with a 0.01 m/z tolerance.</li> <li>Finding MS2 peak at m/z 86.09697 with a 0.01 m/z tolerance, a minimum percent intensity relative to base peak of 10.0%, and a minimum intensity value of 2000.0.</li> </ul>"},{"location":"usecases/#massql-query-link_2","title":"MassQL Query Link","text":"<p>MassQL Query Link</p>"},{"location":"usecases/#additional-data-analysis_3","title":"Additional Data Analysis","text":""},{"location":"usecases/#gnps-feature-based-molecular-networking","title":"GNPS Feature-based Molecular Networking","text":"<p>GNPS Feature-based Molecular Networking</p>"},{"location":"usecases/#data-availability_2","title":"Data Availability","text":"<p>MSV000081004</p>"},{"location":"usecases/#background_3","title":"Background","text":"<p>Current treatments for neglected parasitic diseases suffer from low efficacy, high rates of adverse effects, and emergence of drug resistance. Identifying metabolic pathways altered by infection in vivo may lead to the discovery of new antiparasitic treatment strategies, which are sorely needed. Studies of infection-modulated metabolites have revealed infection-induced metabolic perturbations in multiple members of the glycerophosphocholine family of phospholipids, necessitating a detailed investigation of this family of metabolites under infection conditions.</p> <p>Glycerophosphocholines have four diagnostic MS2 fragmentation peaks in positive mode: m/z 184.0739 (phosphocholine), m/z 125.0004 (2,2-Dihydroxy-1,3,2-dioxaphospholan-2-ium), m/z 104.1075 (choline), and m/z 86.09697 (N,N,N-Trimethylethenaminium) from the phospholipid head group. We therefore built a MassQL query to search a dataset of Leishmania major-infected and uninfected mouse ear tissue.</p>"},{"location":"usecases/#results_2","title":"Results","text":"<p>The MassQL query returned all of the glycerophosphocholines that had previously been annotated via molecular networking and manually inspected for the presence of the four MS2 glycerophosphocholine diagnostic peaks. Prior manual analysis had taken over 4 hours, whereas the MassQL run took 2.5 minutes, followed by approximately 15 minutes of results exploration. In addition, this query returned four more features (m/z 518.3235 retention time 203.635 sec, m/z 552.3299 retention time 172.307 sec, m/z 600.403 retention time 224.992 sec, and m/z 768.5895 retention time 366.716 sec). Using LIPIDMAPS and based on precursor mass, we annotate m/z 518.3235 as LPC 18:3, m/z 552.3299 as PC 19:0, m/z 600.403 as LPC 24:4, LPC O-24:5;O or PC O-24:4, and m/z 768.5895 as PC O-36:4. These features had been missed in our prior analyses because they were singleton network nodes and had not returned a library match using our prior networking parameters.</p> <p>TODO: Insert Figure</p>"},{"location":"usecases/#metabolism-of-antibiotic-trimethoprim-by-burkholderia-cenocepacia","title":"Metabolism of Antibiotic Trimethoprim by Burkholderia cenocepacia","text":"<p>Author/s: Neha Garg and Andrew McAvoy</p>"},{"location":"usecases/#massql-query_4","title":"MassQL Query","text":"<p>QUERY scaninfo(MS2DATA) WHERE  MS2PROD=291.1458 AND MS2PROD=123.0665</p>"},{"location":"usecases/#massql-translation_4","title":"MassQL Translation","text":"<p>Returning the scan information on MS2. The following conditions are applied to find scans in the mass spec data:</p> <ul> <li>Finding MS2 peak at m/z 291.1458.</li> <li>Finding MS2 peak at m/z 123.0665.</li> </ul>"},{"location":"usecases/#massql-query-link_3","title":"MassQL Query Link","text":"<p>MassQL Query Link</p>"},{"location":"usecases/#additional-data-analysis_4","title":"Additional Data Analysis","text":""},{"location":"usecases/#gnps-feature-based-molecular-networking_1","title":"GNPS Feature-based Molecular Networking","text":"<p>GNPS Feature-based Molecular Networking</p>"},{"location":"usecases/#data-availability_3","title":"Data Availability","text":"<p>MSV000084945</p>"},{"location":"usecases/#background_4","title":"Background","text":"<p>Trimethoprim, when combined with sulfamethoxazole, is a bactericidal antibiotic used by clinicians to treat bacterial infections, such as those caused by Burkholderia cepacia complex (Bcc) bacteria in cystic fibrosis patients. Burkholderia spp. are well known for their ability to metabolize xenobiotic compounds. In a previous untargeted metabolomics study, we cultured Bcc bacteria in the presence and absence of trimethoprim. In MS/MS, trimethoprim features a prominent peak with m/z 123.0665 generated by cleavage of a carbon-carbon bond of the methylene connecting the two rings, yielding the 2,4-diaminopyrimidin-5-yl-methylium fragment ion (SI Figure 1.4 - 1). With MassQL, we were able to identify spectra containing fragment masses corresponding to trimethoprim (m/z 291.1452) and the 2,4-diaminopyrimidin-5-yl-methylium fragment, allowing us to mine our dataset for metabolomic features that correspond to novel biotransformation products of trimethoprim.</p>"},{"location":"usecases/#results_3","title":"Results","text":"<p>This MassQL query returned a list of metabolites which display an MS2 fragmentation pattern indicative of a trimethoprim substructure, facilitating the identification of trimethoprim biotransformation products. Manual inspection revealed that 33 out of the 47 candidate features truly contained a trimethoprim substructure, which can undoubtedly be improved by optimizing the query. Previously, we relied on MS2LDA to find compounds containing a trimethoprim substructure, which involves extracting Mass2Motifs from data, manually inspecting the Mass2Motifs found in trimethoprim, and searching for all other molecules which contain relevant Mass2Motifs. MassQL provided additional flexibility to refine the Mass2Motif pattern. Notably, the MassQL query correctly identified a molecule with m/z 549.129 as containing a trimethoprim substructure, which was not recognized by MS2LDA analysis. Although manual inspection of raw data should always be performed to verify in silico predictions, MassQL has the potential to greatly streamline metabolomic analysis in a manner that can be creatively applied based on the unique analysis needs of a particular dataset.</p> <p>TODO: Insert Figure</p>"},{"location":"usecases/#investigating-cannabidiol-degradation-products-using-massql","title":"Investigating Cannabidiol Degradation Products using MassQL","text":"<p>Author/s: Matthew J. Bertin and Riley D. Kirk</p>"},{"location":"usecases/#massql-query_5","title":"MassQL Query","text":"<p>QUERY scaninfo(MS2DATA) WHERE  MS2PROD=259.5:TOLERANCEMZ=0.5</p>"},{"location":"usecases/#massql-translation_5","title":"MassQL Translation","text":"<p>Returning the scan information on MS2. The following conditions are applied to find scans in the mass spec data:</p> <ul> <li>Finding MS2 peak at m/z 259.5 with a 0.5 m/z tolerance.</li> </ul>"},{"location":"usecases/#massql-query-links","title":"MassQL Query Links","text":"<ul> <li>Day 1: MassQL Query Link (day 1)</li> <li>Day 4: MassQL Query Link (day 4)</li> </ul>"},{"location":"usecases/#additional-data-analysis_5","title":"Additional Data Analysis","text":""},{"location":"usecases/#gnps-molecular-networking_2","title":"GNPS Molecular Networking","text":"<ul> <li>Day 1: GNPS Molecular Networking (day 1)</li> <li>Day 4: GNPS Molecular Networking (day 4)</li> </ul>"},{"location":"usecases/#background_5","title":"Background","text":"<p>Cannabidiol (CBD) is a major phytocannabinoid found in Cannabis plants. The use of CBD continues to gain interest in the pharmaceutical, nutraceutical, and even the cosmeceutical industries. Detection and annotation of cannabidiol degradation products remain important for understanding the stability and quality of the now numerous CBD products available to the public. This understanding is especially critical with recent research demonstrating the biological activity (inhibition of topoisomerase II\u237a and \u03b2) of an oxidized cannabidiol quinone (CBDQ). </p>"},{"location":"usecases/#methods","title":"Methods","text":"<p>We analyzed purified CBD at two time periods (t = 0 d and t = 4 d) following exposure to natural light. The clear solution on day 0 began to take on a pale yellow color by day 4. LC-MS/MS data were acquired in data-dependent mode using a Thermo Scientific LTQ XL. We utilized mass query language to identify product ion m/z 259, a prominent fragment ion from cannabinoid precursors. We subsequently subjected each query analysis to molecular networking and examined the changes in chemical space over time.</p>"},{"location":"usecases/#results_4","title":"Results","text":"<p>At day 0, eight unique precursor m/z values were identified with the m/z 259 product ion. By day 4, over fifty unique precursor m/z values were identified, including a putative identification of CBD quinone (m/z 329), and many other likely degradation products. This approach shows an effective means to mine mass spectrometry data to identify potential CBD degradation molecules for quality control as more and more consumers utilize these products.</p> <p>TODO: INsert figure</p>"},{"location":"usecases/#finding-drug-metabolites-from-public-fecal-datasets","title":"Finding Drug Metabolites from Public Fecal Datasets","text":"<p>Author/s: Kyo Bin Kang</p>"},{"location":"usecases/#massql-query_6","title":"MassQL Query","text":"<p>QUERY scaninfo(MS2DATA) WHERE  MS2PROD=311.1508:TOLERANCEMZ=0.0025:INTENSITYPERCENT&gt;5</p>"},{"location":"usecases/#massql-translation_6","title":"MassQL Translation","text":"<p>Returning the scan information on MS2. The following conditions are applied to find scans in the mass spec data:</p> <ul> <li>Finding MS2 peak at m/z 311.1508 with a 0.0025 m/z tolerance and a minimum percent intensity relative to base peak of 5.0%.</li> </ul>"},{"location":"usecases/#massql-query-link_4","title":"MassQL Query Link","text":"<p>MassQL Query Link</p>"},{"location":"usecases/#additional-data-analysis_6","title":"Additional Data Analysis","text":"<p>N/A</p>"},{"location":"usecases/#data-availability_4","title":"Data Availability","text":"<p>MSV000080673 and MSV000082221</p>"},{"location":"usecases/#background_6","title":"Background","text":"<p>In a previous study, we identified 68 putative metabolites of sildenafil by applying molecular networking analysis on LC-MS/MS data of in vitro microsomal biotransformation experiments. The MASST search of these spectra revealed that at least four public datasets (all the data were human fecal extracts) contained intact sildenafil or its major metabolite of m/z 449.1971. However, other metabolites were not found in the MASST analysis. Further investigation revealed that the matched data actually contained other metabolites, but they were not detected due to the low cosine similarity, which was mainly caused by significantly different ion intensities of fragment ions.</p>"},{"location":"usecases/#methods_1","title":"Methods","text":"<p>We queried a common fragment of sildenafil metabolites, m/z 311.1508, and this query revealed the occurrence of other sildenafil metabolites in four matched datasets. We found 150 MS/MS scans containing a fragment ion of m/z 311.1508 from four public fecal extract data files. Some of these were identified as sildenafil metabolites in our previous study by comparing their spectra with the experimental spectra acquired in our in vitro work.</p>"},{"location":"usecases/#results_5","title":"Results","text":"<p>In the previous study, we discussed that these metabolites were not found in the MASST search because they showed low cosine similarity to the experimental spectra due to the different relative intensities between fragments. By visualizing extracted ion chromatograms (EICs) of identified metabolites and manually comparing m/z values of major fragment ions, we successfully found drug metabolites with the characteristic fragment ion using MassQL. This demonstrates that we can find drug metabolites from public datasets more easily even when their MS/MS spectra show low cosine similarity to our reference spectra.</p> <p>TODO: Insert figure</p>"},{"location":"visualizer/","title":"MassQL Query Visualizer","text":"<p>MassQL has a visualizer to help you figure out what your query is looking for. It is available at our sandbox. </p> <p>The following will describe what the shapes and symbols mean:</p>"},{"location":"visualizer/#ms-peak-mass","title":"MS Peak Mass","text":"<p>This can be either MS2PROD or MS1MZ, green boxes around where the allowble m/z tolerance determined by qualifiers is set. </p> <p></p>"},{"location":"visualizer/#ms2-neutral-loss","title":"MS2 Neutral Loss","text":"<p>These are MS2NL keywords and are shown as red boxes. </p> <p></p>"},{"location":"visualizer/#peak-intensity-minimum","title":"Peak Intensity Minimum","text":"<p>This is a red dashed line, with a small red arrow indicating it is a minimum. </p> <p></p>"},{"location":"visualizer/#peak-intensity-match","title":"Peak Intensity Match","text":"<p>The ranges are purple dashed lines with arrows denoting the included rage. </p> <p></p>"},{"location":"visualizer/#variables","title":"Variables","text":"<p>You can set the variables you want with Value X and Value Y</p>"},{"location":"visualizer/#overlaying-real-data","title":"Overlaying Real Data","text":"<p>If you enter the USI (universal spectrum identifier) for the MS1 or MS2 spectra, you can overlay your query with an actual spectrum to workshop what you're trying to find. </p> <p></p>"}]}